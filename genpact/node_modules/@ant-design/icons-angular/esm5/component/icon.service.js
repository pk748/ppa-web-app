import { __assign, __decorate, __param, __read } from "tslib";
import { DOCUMENT } from '@angular/common';
import { HttpBackend, HttpClient } from '@angular/common/http';
import { Inject, Injectable, Optional, Renderer2, RendererFactory2, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { of as rxof, Observable, Subject } from 'rxjs';
import { catchError, filter, finalize, map, share, take, tap } from 'rxjs/operators';
import { cloneSVG, getIconDefinitionFromAbbr, getNameAndNamespace, getSecondaryColor, hasNamespace, isIconDefinition, replaceFillColor, warn, withSuffix, withSuffixAndColor } from '../utils';
import { DynamicLoadingTimeoutError, HttpModuleNotImport, IconNotFoundError, NameSpaceIsNotSpecifyError, SVGTagNotFoundError, UrlNotSafeError } from './icon.error';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@angular/platform-browser';
var JSONP_HANDLER_NAME = '__ant_icon_load';
var IconService = /** @class */ (function () {
    function IconService(_rendererFactory, _handler, 
    // tslint:disable-next-line:no-any
    _document, sanitizer) {
        this._rendererFactory = _rendererFactory;
        this._handler = _handler;
        this._document = _document;
        this.sanitizer = sanitizer;
        this.defaultTheme = 'outline';
        /**
         * All icon definitions would be registered here.
         */
        this._svgDefinitions = new Map();
        /**
         * Cache all rendered icons. Icons are identified by name, theme,
         * and for twotone icons, primary color and secondary color.
         */
        this._svgRenderedDefinitions = new Map();
        this._inProgressFetches = new Map();
        /**
         * Url prefix for fetching inline SVG by dynamic importing.
         */
        this._assetsUrlRoot = '';
        this._twoToneColorPalette = {
            primaryColor: '#333333',
            secondaryColor: '#E6E6E6'
        };
        /** A flag indicates whether jsonp loading is enabled. */
        this._enableJsonpLoading = false;
        this._jsonpIconLoad$ = new Subject();
        this._renderer = this._rendererFactory.createRenderer(null, null);
        if (this._handler) {
            this._http = new HttpClient(this._handler);
        }
    }
    Object.defineProperty(IconService.prototype, "twoToneColor", {
        get: function () {
            // Make a copy to avoid unexpected changes.
            return __assign({}, this._twoToneColorPalette);
        },
        set: function (_a) {
            var primaryColor = _a.primaryColor, secondaryColor = _a.secondaryColor;
            this._twoToneColorPalette.primaryColor = primaryColor;
            this._twoToneColorPalette.secondaryColor =
                secondaryColor || getSecondaryColor(primaryColor);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Call this method to switch to jsonp like loading.
     */
    IconService.prototype.useJsonpLoading = function () {
        var _this = this;
        if (!this._enableJsonpLoading) {
            this._enableJsonpLoading = true;
            window[JSONP_HANDLER_NAME] = function (icon) {
                _this._jsonpIconLoad$.next(icon);
            };
        }
        else {
            warn('You are already using jsonp loading.');
        }
    };
    /**
     * Change the prefix of the inline svg resources, so they could be deployed elsewhere, like CDN.
     * @param prefix
     */
    IconService.prototype.changeAssetsSource = function (prefix) {
        this._assetsUrlRoot = prefix.endsWith('/') ? prefix : prefix + '/';
    };
    /**
     * Add icons provided by ant design.
     * @param icons
     */
    IconService.prototype.addIcon = function () {
        var _this = this;
        var icons = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            icons[_i] = arguments[_i];
        }
        icons.forEach(function (icon) {
            _this._svgDefinitions.set(withSuffix(icon.name, icon.theme), icon);
        });
    };
    /**
     * Register an icon. Namespace is required.
     * @param type
     * @param literal
     */
    IconService.prototype.addIconLiteral = function (type, literal) {
        var _a = __read(getNameAndNamespace(type), 2), _ = _a[0], namespace = _a[1];
        if (!namespace) {
            throw NameSpaceIsNotSpecifyError();
        }
        this.addIcon({ name: type, icon: literal });
    };
    /**
     * Remove all cache.
     */
    IconService.prototype.clear = function () {
        this._svgDefinitions.clear();
        this._svgRenderedDefinitions.clear();
    };
    /**
     * Get a rendered `SVGElement`.
     * @param icon
     * @param twoToneColor
     */
    IconService.prototype.getRenderedContent = function (icon, twoToneColor) {
        var _this = this;
        // If `icon` is a `IconDefinition`, go to the next step. If not, try to fetch it from cache.
        var definitionOrNull = isIconDefinition(icon)
            ? icon
            : this._svgDefinitions.get(icon) || null;
        // If `icon` is a `IconDefinition` of successfully fetch, wrap it in an `Observable`.
        // Otherwise try to fetch it from remote.
        var $iconDefinition = definitionOrNull
            ? rxof(definitionOrNull)
            : this._loadIconDynamically(icon);
        // If finally get an `IconDefinition`, render and return it. Otherwise throw an error.
        return $iconDefinition.pipe(map(function (i) {
            if (!i) {
                throw IconNotFoundError(icon);
            }
            return _this._loadSVGFromCacheOrCreateNew(i, twoToneColor);
        }));
    };
    IconService.prototype.getCachedIcons = function () {
        return this._svgDefinitions;
    };
    /**
     * Get raw svg and assemble a `IconDefinition` object.
     * @param type
     */
    IconService.prototype._loadIconDynamically = function (type) {
        var _this = this;
        // If developer doesn't provide HTTP module nor enable jsonp loading, just throw an error.
        if (!this._http && !this._enableJsonpLoading) {
            return rxof(HttpModuleNotImport());
        }
        // If multi directive ask for the same icon at the same time,
        // request should only be fired once.
        var inProgress = this._inProgressFetches.get(type);
        if (!inProgress) {
            var _a = __read(getNameAndNamespace(type), 2), name_1 = _a[0], namespace = _a[1];
            // If the string has a namespace within, create a simple `IconDefinition`.
            var icon_1 = namespace
                ? { name: type, icon: '' }
                : getIconDefinitionFromAbbr(name_1);
            var suffix = this._enableJsonpLoading ? '.js' : '.svg';
            var url = (namespace
                ? this._assetsUrlRoot + "assets/" + namespace + "/" + name_1
                : this._assetsUrlRoot + "assets/" + icon_1.theme + "/" + icon_1.name) + suffix;
            var safeUrl = this.sanitizer.sanitize(SecurityContext.URL, url);
            if (!safeUrl) {
                throw UrlNotSafeError(url);
            }
            var source = !this._enableJsonpLoading
                ? this._http
                    .get(safeUrl, { responseType: 'text' })
                    .pipe(map(function (literal) { return (__assign(__assign({}, icon_1), { icon: literal })); }))
                : this._loadIconDynamicallyWithJsonp(icon_1, safeUrl);
            inProgress = source.pipe(tap(function (definition) { return _this.addIcon(definition); }), finalize(function () { return _this._inProgressFetches.delete(type); }), catchError(function () { return rxof(null); }), share());
            this._inProgressFetches.set(type, inProgress);
        }
        return inProgress;
    };
    IconService.prototype._loadIconDynamicallyWithJsonp = function (icon, url) {
        var _this = this;
        return new Observable(function (subscriber) {
            var loader = _this._document.createElement('script');
            var timer = setTimeout(function () {
                clean();
                subscriber.error(DynamicLoadingTimeoutError());
            }, 6000);
            loader.src = url;
            function clean() {
                loader.parentNode.removeChild(loader);
                clearTimeout(timer);
            }
            _this._document.body.appendChild(loader);
            _this._jsonpIconLoad$
                .pipe(filter(function (i) { return i.name === icon.name && i.theme === icon.theme; }), take(1))
                .subscribe(function (i) {
                subscriber.next(i);
                clean();
            });
        });
    };
    /**
     * Render a new `SVGElement` for a given `IconDefinition`, or make a copy from cache.
     * @param icon
     * @param twoToneColor
     */
    IconService.prototype._loadSVGFromCacheOrCreateNew = function (icon, twoToneColor) {
        var svg;
        var pri = twoToneColor || this._twoToneColorPalette.primaryColor;
        var sec = getSecondaryColor(pri) || this._twoToneColorPalette.secondaryColor;
        var key = icon.theme === 'twotone'
            ? withSuffixAndColor(icon.name, icon.theme, pri, sec)
            : icon.theme === undefined
                ? icon.name
                : withSuffix(icon.name, icon.theme);
        // Try to make a copy from cache.
        var cached = this._svgRenderedDefinitions.get(key);
        if (cached) {
            svg = cached.icon;
        }
        else {
            svg = this._setSVGAttribute(this._colorizeSVGIcon(
            // Icons provided by ant design should be refined to remove preset colors.
            this._createSVGElementFromString(hasNamespace(icon.name) ? icon.icon : replaceFillColor(icon.icon)), icon.theme === 'twotone', pri, sec));
            // Cache it.
            this._svgRenderedDefinitions.set(key, __assign(__assign({}, icon), { icon: svg }));
        }
        return cloneSVG(svg);
    };
    IconService.prototype._createSVGElementFromString = function (str) {
        var div = this._document.createElement('div');
        div.innerHTML = str;
        var svg = div.querySelector('svg');
        if (!svg) {
            throw SVGTagNotFoundError;
        }
        return svg;
    };
    IconService.prototype._setSVGAttribute = function (svg) {
        this._renderer.setAttribute(svg, 'width', '1em');
        this._renderer.setAttribute(svg, 'height', '1em');
        return svg;
    };
    IconService.prototype._colorizeSVGIcon = function (svg, twotone, pri, sec) {
        if (twotone) {
            var children = svg.childNodes;
            var length_1 = children.length;
            for (var i = 0; i < length_1; i++) {
                var child = children[i];
                if (child.getAttribute('fill') === 'secondaryColor') {
                    this._renderer.setAttribute(child, 'fill', sec);
                }
                else {
                    this._renderer.setAttribute(child, 'fill', pri);
                }
            }
        }
        this._renderer.setAttribute(svg, 'fill', 'currentColor');
        return svg;
    };
    IconService.ctorParameters = function () { return [
        { type: RendererFactory2 },
        { type: HttpBackend, decorators: [{ type: Optional }] },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DOCUMENT,] }] },
        { type: DomSanitizer }
    ]; };
    IconService = __decorate([ __param(1, Optional()),
        __param(2, Optional()), __param(2, Inject(DOCUMENT))
    ], IconService);
IconService.ɵfac = function IconService_Factory(t) { return new (t || IconService)(ɵngcc0.ɵɵinject(ɵngcc0.RendererFactory2), ɵngcc0.ɵɵinject(ɵngcc1.HttpBackend, 8), ɵngcc0.ɵɵinject(DOCUMENT, 8), ɵngcc0.ɵɵinject(ɵngcc2.DomSanitizer)); };
IconService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: IconService, factory: function (t) { return IconService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(IconService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.RendererFactory2 }, { type: ɵngcc1.HttpBackend, decorators: [{
                type: Optional
            }] }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [DOCUMENT]
            }] }, { type: ɵngcc2.DomSanitizer }]; }, null); })();
    return IconService;
}());
export { IconService };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWNvbi5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGFudC1kZXNpZ24vaWNvbnMtYW5ndWxhci9jb21wb25lbnQvaWNvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzRyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQ0wsVUFBVSxFQUNWLE1BQU0sRUFDTixRQUFRLEVBQ1IsR0FBRyxFQUNILEtBQUssRUFDTCxJQUFJLEVBQ0osR0FBRyxFQUNKLE1BQU0sZ0JBQWdCLENBQUM7QUFReEIsT0FBTyxFQUNMLFFBQVEsRUFDUix5QkFBeUIsRUFDekIsbUJBQW1CLEVBQ25CLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osZ0JBQWdCLEVBQ2hCLGdCQUFnQixFQUNoQixJQUFJLEVBQ0osVUFBVSxFQUNWLGtCQUFrQixFQUNuQixNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQ0wsMEJBQTBCLEVBQzFCLG1CQUFtQixFQUNuQixpQkFBaUIsRUFDakIsMEJBQTBCLEVBQzFCLG1CQUFtQixFQUNuQixlQUFlLEVBQ2hCLE1BQU0sY0FBYyxDQUFDOzs7O0FBRXRCLElBQU0sa0JBQWtCLEdBQUcsaUJBQWlCLENBQUM7QUFHN0M7QUFDb0IsSUFpRGxCLHFCQUNZLGdCQUFrQyxFQUN0QixRQUFxQjtBQUM5QyxJQUFHLGtDQUFrQztBQUN0QyxJ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USxJQUFJLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEtBQUssZ0JBQWdCLEVBQUU7QUFDN0Qsb0JBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztBQUMxRCxpQkFBUztBQUFDLHFCQUFLO0FBQ2Ysb0JBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztBQUMxRCxpQkFBUztBQUNULGFBQU87QUFDUCxTQUFLO0FBQ0wsUUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0FBQzdELFFBQUksT0FBTyxHQUFHLENBQUM7QUFDZixJQUFFLENBQUM7QUFDRjtBQUNzRCxnQkE5UXZCLGdCQUFnQjtBQUM5QyxnQkFBa0MsV0FBVyx1QkFBMUMsUUFBUTtBQUFPLGdEQUVmLFFBQVEsWUFBSSxNQUFNLFNBQUMsUUFBUTtBQUFTLGdCQUNoQixZQUFZO0FBQ25DO0FBQ0ksSUF6RE8sV0FBVyx3QkFEdkIsVUFBVSxFQUFFLHJCQUNMLENBb0RILFdBQUEsUUFBUSxFQUFFLENBQUE7QUFBRSxRQUVaLFdBQUEsUUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUFDLE9BdERyQixXQUFXLENBZ1V2Qjs7Ozs7Ozs7Ozs7O2lFQUNEO0FBQUMsSUFERCxrQkFBQztBQUNBLENBREEsQUFoVUQsSUFnVUM7QUFDRCxTQWpVYSxXQUFXO0FBQ3ZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSHR0cEJhY2tlbmQsIEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9wdGlvbmFsLCBSZW5kZXJlcjIsIFJlbmRlcmVyRmFjdG9yeTIsIFNlY3VyaXR5Q29udGV4dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBvZiBhcyByeG9mLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICBjYXRjaEVycm9yLFxuICBmaWx0ZXIsXG4gIGZpbmFsaXplLFxuICBtYXAsXG4gIHNoYXJlLFxuICB0YWtlLFxuICB0YXBcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgQ2FjaGVkSWNvbkRlZmluaXRpb24sXG4gIEljb25EZWZpbml0aW9uLFxuICBUaGVtZVR5cGUsXG4gIFR3b1RvbmVDb2xvclBhbGV0dGUsXG4gIFR3b1RvbmVDb2xvclBhbGV0dGVTZXR0ZXJcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtcbiAgY2xvbmVTVkcsXG4gIGdldEljb25EZWZpbml0aW9uRnJvbUFiYnIsXG4gIGdldE5hbWVBbmROYW1lc3BhY2UsXG4gIGdldFNlY29uZGFyeUNvbG9yLFxuICBoYXNOYW1lc3BhY2UsXG4gIGlzSWNvbkRlZmluaXRpb24sXG4gIHJlcGxhY2VGaWxsQ29sb3IsXG4gIHdhcm4sXG4gIHdpdGhTdWZmaXgsXG4gIHdpdGhTdWZmaXhBbmRDb2xvclxufSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQge1xuICBEeW5hbWljTG9hZGluZ1RpbWVvdXRFcnJvcixcbiAgSHR0cE1vZHVsZU5vdEltcG9ydCxcbiAgSWNvbk5vdEZvdW5kRXJyb3IsXG4gIE5hbWVTcGFjZUlzTm90U3BlY2lmeUVycm9yLFxuICBTVkdUYWdOb3RGb3VuZEVycm9yLFxuICBVcmxOb3RTYWZlRXJyb3Jcbn0gZnJvbSAnLi9pY29uLmVycm9yJztcblxuY29uc3QgSlNPTlBfSEFORExFUl9OQU1FID0gJ19fYW50X2ljb25fbG9hZCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBJY29uU2VydmljZSB7XG4gIGRlZmF1bHRUaGVtZTogVGhlbWVUeXBlID0gJ291dGxpbmUnO1xuXG4gIHNldCB0d29Ub25lQ29sb3Ioe1xuICAgIHByaW1hcnlDb2xvcixcbiAgICBzZWNvbmRhcnlDb2xvclxuICB9OiBUd29Ub25lQ29sb3JQYWxldHRlU2V0dGVyKSB7XG4gICAgdGhpcy5fdHdvVG9uZUNvbG9yUGFsZXR0ZS5wcmltYXJ5Q29sb3IgPSBwcmltYXJ5Q29sb3I7XG4gICAgdGhpcy5fdHdvVG9uZUNvbG9yUGFsZXR0ZS5zZWNvbmRhcnlDb2xvciA9XG4gICAgICBzZWNvbmRhcnlDb2xvciB8fCBnZXRTZWNvbmRhcnlDb2xvcihwcmltYXJ5Q29sb3IpO1xuICB9XG5cbiAgZ2V0IHR3b1RvbmVDb2xvcigpOiBUd29Ub25lQ29sb3JQYWxldHRlU2V0dGVyIHtcbiAgICAvLyBNYWtlIGEgY29weSB0byBhdm9pZCB1bmV4cGVjdGVkIGNoYW5nZXMuXG4gICAgcmV0dXJuIHsgLi4udGhpcy5fdHdvVG9uZUNvbG9yUGFsZXR0ZSB9IGFzIFR3b1RvbmVDb2xvclBhbGV0dGU7XG4gIH1cblxuICBwcm90ZWN0ZWQgX3JlbmRlcmVyOiBSZW5kZXJlcjI7XG4gIHByb3RlY3RlZCBfaHR0cDogSHR0cENsaWVudDtcblxuICAvKipcbiAgICogQWxsIGljb24gZGVmaW5pdGlvbnMgd291bGQgYmUgcmVnaXN0ZXJlZCBoZXJlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IF9zdmdEZWZpbml0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBJY29uRGVmaW5pdGlvbj4oKTtcblxuICAvKipcbiAgICogQ2FjaGUgYWxsIHJlbmRlcmVkIGljb25zLiBJY29ucyBhcmUgaWRlbnRpZmllZCBieSBuYW1lLCB0aGVtZSxcbiAgICogYW5kIGZvciB0d290b25lIGljb25zLCBwcmltYXJ5IGNvbG9yIGFuZCBzZWNvbmRhcnkgY29sb3IuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgX3N2Z1JlbmRlcmVkRGVmaW5pdGlvbnMgPSBuZXcgTWFwPHN0cmluZywgQ2FjaGVkSWNvbkRlZmluaXRpb24+KCk7XG5cbiAgcHJvdGVjdGVkIF9pblByb2dyZXNzRmV0Y2hlcyA9IG5ldyBNYXA8XG4gICAgc3RyaW5nLFxuICAgIE9ic2VydmFibGU8SWNvbkRlZmluaXRpb24gfCBudWxsPlxuICA+KCk7XG5cbiAgLyoqXG4gICAqIFVybCBwcmVmaXggZm9yIGZldGNoaW5nIGlubGluZSBTVkcgYnkgZHluYW1pYyBpbXBvcnRpbmcuXG4gICAqL1xuICBwcm90ZWN0ZWQgX2Fzc2V0c1VybFJvb3QgPSAnJztcblxuICBwcm90ZWN0ZWQgX3R3b1RvbmVDb2xvclBhbGV0dGU6IFR3b1RvbmVDb2xvclBhbGV0dGUgPSB7XG4gICAgcHJpbWFyeUNvbG9yOiAnIzMzMzMzMycsXG4gICAgc2Vjb25kYXJ5Q29sb3I6ICcjRTZFNkU2J1xuICB9O1xuXG4gIC8qKiBBIGZsYWcgaW5kaWNhdGVzIHdoZXRoZXIganNvbnAgbG9hZGluZyBpcyBlbmFibGVkLiAqL1xuICBwcml2YXRlIF9lbmFibGVKc29ucExvYWRpbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSByZWFkb25seSBfanNvbnBJY29uTG9hZCQgPSBuZXcgU3ViamVjdDxJY29uRGVmaW5pdGlvbj4oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgX3JlbmRlcmVyRmFjdG9yeTogUmVuZGVyZXJGYWN0b3J5MixcbiAgICBAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgX2hhbmRsZXI6IEh0dHBCYWNrZW5kLFxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KERPQ1VNRU5UKSBwcm90ZWN0ZWQgX2RvY3VtZW50OiBhbnksXG4gICAgcHJvdGVjdGVkIHNhbml0aXplcjogRG9tU2FuaXRpemVyXG4gICkge1xuICAgIHRoaXMuX3JlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKG51bGwsIG51bGwpO1xuICAgIGlmICh0aGlzLl9oYW5kbGVyKSB7XG4gICAgICB0aGlzLl9odHRwID0gbmV3IEh0dHBDbGllbnQodGhpcy5faGFuZGxlcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGwgdGhpcyBtZXRob2QgdG8gc3dpdGNoIHRvIGpzb25wIGxpa2UgbG9hZGluZy5cbiAgICovXG4gIHVzZUpzb25wTG9hZGluZygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuX2VuYWJsZUpzb25wTG9hZGluZykge1xuICAgICAgdGhpcy5fZW5hYmxlSnNvbnBMb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgd2luZG93W0pTT05QX0hBTkRMRVJfTkFNRV0gPSAoaWNvbjogSWNvbkRlZmluaXRpb24pID0+IHtcbiAgICAgICAgdGhpcy5fanNvbnBJY29uTG9hZCQubmV4dChpY29uKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHdhcm4oJ1lvdSBhcmUgYWxyZWFkeSB1c2luZyBqc29ucCBsb2FkaW5nLicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIHByZWZpeCBvZiB0aGUgaW5saW5lIHN2ZyByZXNvdXJjZXMsIHNvIHRoZXkgY291bGQgYmUgZGVwbG95ZWQgZWxzZXdoZXJlLCBsaWtlIENETi5cbiAgICogQHBhcmFtIHByZWZpeFxuICAgKi9cbiAgY2hhbmdlQXNzZXRzU291cmNlKHByZWZpeDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5fYXNzZXRzVXJsUm9vdCA9IHByZWZpeC5lbmRzV2l0aCgnLycpID8gcHJlZml4IDogcHJlZml4ICsgJy8nO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBpY29ucyBwcm92aWRlZCBieSBhbnQgZGVzaWduLlxuICAgKiBAcGFyYW0gaWNvbnNcbiAgICovXG4gIGFkZEljb24oLi4uaWNvbnM6IEljb25EZWZpbml0aW9uW10pOiB2b2lkIHtcbiAgICBpY29ucy5mb3JFYWNoKGljb24gPT4ge1xuICAgICAgdGhpcy5fc3ZnRGVmaW5pdGlvbnMuc2V0KHdpdGhTdWZmaXgoaWNvbi5uYW1lLCBpY29uLnRoZW1lKSwgaWNvbik7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYW4gaWNvbi4gTmFtZXNwYWNlIGlzIHJlcXVpcmVkLlxuICAgKiBAcGFyYW0gdHlwZVxuICAgKiBAcGFyYW0gbGl0ZXJhbFxuICAgKi9cbiAgYWRkSWNvbkxpdGVyYWwodHlwZTogc3RyaW5nLCBsaXRlcmFsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBbXywgbmFtZXNwYWNlXSA9IGdldE5hbWVBbmROYW1lc3BhY2UodHlwZSk7XG4gICAgaWYgKCFuYW1lc3BhY2UpIHtcbiAgICAgIHRocm93IE5hbWVTcGFjZUlzTm90U3BlY2lmeUVycm9yKCk7XG4gICAgfVxuICAgIHRoaXMuYWRkSWNvbih7IG5hbWU6IHR5cGUsIGljb246IGxpdGVyYWwgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGFsbCBjYWNoZS5cbiAgICovXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMuX3N2Z0RlZmluaXRpb25zLmNsZWFyKCk7XG4gICAgdGhpcy5fc3ZnUmVuZGVyZWREZWZpbml0aW9ucy5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHJlbmRlcmVkIGBTVkdFbGVtZW50YC5cbiAgICogQHBhcmFtIGljb25cbiAgICogQHBhcmFtIHR3b1RvbmVDb2xvclxuICAgKi9cbiAgZ2V0UmVuZGVyZWRDb250ZW50KFxuICAgIGljb246IEljb25EZWZpbml0aW9uIHwgc3RyaW5nLFxuICAgIHR3b1RvbmVDb2xvcj86IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPFNWR0VsZW1lbnQ+IHtcbiAgICAvLyBJZiBgaWNvbmAgaXMgYSBgSWNvbkRlZmluaXRpb25gLCBnbyB0byB0aGUgbmV4dCBzdGVwLiBJZiBub3QsIHRyeSB0byBmZXRjaCBpdCBmcm9tIGNhY2hlLlxuICAgIGNvbnN0IGRlZmluaXRpb25Pck51bGw6IEljb25EZWZpbml0aW9uIHwgbnVsbCA9IGlzSWNvbkRlZmluaXRpb24oaWNvbilcbiAgICAgID8gKGljb24gYXMgSWNvbkRlZmluaXRpb24pXG4gICAgICA6IHRoaXMuX3N2Z0RlZmluaXRpb25zLmdldChpY29uKSB8fCBudWxsO1xuXG4gICAgLy8gSWYgYGljb25gIGlzIGEgYEljb25EZWZpbml0aW9uYCBvZiBzdWNjZXNzZnVsbHkgZmV0Y2gsIHdyYXAgaXQgaW4gYW4gYE9ic2VydmFibGVgLlxuICAgIC8vIE90aGVyd2lzZSB0cnkgdG8gZmV0Y2ggaXQgZnJvbSByZW1vdGUuXG4gICAgY29uc3QgJGljb25EZWZpbml0aW9uID0gZGVmaW5pdGlvbk9yTnVsbFxuICAgICAgPyByeG9mKGRlZmluaXRpb25Pck51bGwpXG4gICAgICA6IHRoaXMuX2xvYWRJY29uRHluYW1pY2FsbHkoaWNvbiBhcyBzdHJpbmcpO1xuXG4gICAgLy8gSWYgZmluYWxseSBnZXQgYW4gYEljb25EZWZpbml0aW9uYCwgcmVuZGVyIGFuZCByZXR1cm4gaXQuIE90aGVyd2lzZSB0aHJvdyBhbiBlcnJvci5cbiAgICByZXR1cm4gJGljb25EZWZpbml0aW9uLnBpcGUoXG4gICAgICBtYXAoaSA9PiB7XG4gICAgICAgIGlmICghaSkge1xuICAgICAgICAgIHRocm93IEljb25Ob3RGb3VuZEVycm9yKGljb24gYXMgc3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fbG9hZFNWR0Zyb21DYWNoZU9yQ3JlYXRlTmV3KGksIHR3b1RvbmVDb2xvcik7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXRDYWNoZWRJY29ucygpOiBNYXA8c3RyaW5nLCBJY29uRGVmaW5pdGlvbj4ge1xuICAgIHJldHVybiB0aGlzLl9zdmdEZWZpbml0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmF3IHN2ZyBhbmQgYXNzZW1ibGUgYSBgSWNvbkRlZmluaXRpb25gIG9iamVjdC5cbiAgICogQHBhcmFtIHR5cGVcbiAgICovXG4gIHByb3RlY3RlZCBfbG9hZEljb25EeW5hbWljYWxseShcbiAgICB0eXBlOiBzdHJpbmdcbiAgKTogT2JzZXJ2YWJsZTxJY29uRGVmaW5pdGlvbiB8IG51bGw+IHtcbiAgICAvLyBJZiBkZXZlbG9wZXIgZG9lc24ndCBwcm92aWRlIEhUVFAgbW9kdWxlIG5vciBlbmFibGUganNvbnAgbG9hZGluZywganVzdCB0aHJvdyBhbiBlcnJvci5cbiAgICBpZiAoIXRoaXMuX2h0dHAgJiYgIXRoaXMuX2VuYWJsZUpzb25wTG9hZGluZykge1xuICAgICAgcmV0dXJuIHJ4b2YoSHR0cE1vZHVsZU5vdEltcG9ydCgpKTtcbiAgICB9XG5cbiAgICAvLyBJZiBtdWx0aSBkaXJlY3RpdmUgYXNrIGZvciB0aGUgc2FtZSBpY29uIGF0IHRoZSBzYW1lIHRpbWUsXG4gICAgLy8gcmVxdWVzdCBzaG91bGQgb25seSBiZSBmaXJlZCBvbmNlLlxuICAgIGxldCBpblByb2dyZXNzID0gdGhpcy5faW5Qcm9ncmVzc0ZldGNoZXMuZ2V0KHR5cGUpO1xuXG4gICAgaWYgKCFpblByb2dyZXNzKSB7XG4gICAgICBjb25zdCBbbmFtZSwgbmFtZXNwYWNlXSA9IGdldE5hbWVBbmROYW1lc3BhY2UodHlwZSk7XG5cbiAgICAgIC8vIElmIHRoZSBzdHJpbmcgaGFzIGEgbmFtZXNwYWNlIHdpdGhpbiwgY3JlYXRlIGEgc2ltcGxlIGBJY29uRGVmaW5pdGlvbmAuXG4gICAgICBjb25zdCBpY29uOiBJY29uRGVmaW5pdGlvbiA9IG5hbWVzcGFjZVxuICAgICAgICA/IHsgbmFtZTogdHlwZSwgaWNvbjogJycgfVxuICAgICAgICA6IGdldEljb25EZWZpbml0aW9uRnJvbUFiYnIobmFtZSk7XG5cbiAgICAgIGNvbnN0IHN1ZmZpeCA9IHRoaXMuX2VuYWJsZUpzb25wTG9hZGluZyA/ICcuanMnIDogJy5zdmcnO1xuICAgICAgY29uc3QgdXJsID1cbiAgICAgICAgKG5hbWVzcGFjZVxuICAgICAgICAgID8gYCR7dGhpcy5fYXNzZXRzVXJsUm9vdH1hc3NldHMvJHtuYW1lc3BhY2V9LyR7bmFtZX1gXG4gICAgICAgICAgOiBgJHt0aGlzLl9hc3NldHNVcmxSb290fWFzc2V0cy8ke2ljb24udGhlbWV9LyR7aWNvbi5uYW1lfWApICsgc3VmZml4O1xuXG4gICAgICBjb25zdCBzYWZlVXJsID0gdGhpcy5zYW5pdGl6ZXIuc2FuaXRpemUoU2VjdXJpdHlDb250ZXh0LlVSTCwgdXJsKTtcblxuICAgICAgaWYgKCFzYWZlVXJsKSB7XG4gICAgICAgIHRocm93IFVybE5vdFNhZmVFcnJvcih1cmwpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzb3VyY2UgPSAhdGhpcy5fZW5hYmxlSnNvbnBMb2FkaW5nXG4gICAgICAgID8gdGhpcy5faHR0cFxuICAgICAgICAgICAgLmdldChzYWZlVXJsLCB7IHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pXG4gICAgICAgICAgICAucGlwZShtYXAobGl0ZXJhbCA9PiAoeyAuLi5pY29uLCBpY29uOiBsaXRlcmFsIH0pKSlcbiAgICAgICAgOiB0aGlzLl9sb2FkSWNvbkR5bmFtaWNhbGx5V2l0aEpzb25wKGljb24sIHNhZmVVcmwpO1xuXG4gICAgICBpblByb2dyZXNzID0gc291cmNlLnBpcGUoXG4gICAgICAgIHRhcChkZWZpbml0aW9uID0+IHRoaXMuYWRkSWNvbihkZWZpbml0aW9uKSksXG4gICAgICAgIGZpbmFsaXplKCgpID0+IHRoaXMuX2luUHJvZ3Jlc3NGZXRjaGVzLmRlbGV0ZSh0eXBlKSksXG4gICAgICAgIGNhdGNoRXJyb3IoKCkgPT4gcnhvZihudWxsKSksXG4gICAgICAgIHNoYXJlKClcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuX2luUHJvZ3Jlc3NGZXRjaGVzLnNldCh0eXBlLCBpblByb2dyZXNzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5Qcm9ncmVzcztcbiAgfVxuXG4gIHByb3RlY3RlZCBfbG9hZEljb25EeW5hbWljYWxseVdpdGhKc29ucChpY29uOiBJY29uRGVmaW5pdGlvbiwgdXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEljb25EZWZpbml0aW9uPiB7XG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPEljb25EZWZpbml0aW9uPihzdWJzY3JpYmVyID0+IHtcbiAgICAgIGNvbnN0IGxvYWRlciA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgY29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY2xlYW4oKTtcbiAgICAgICAgc3Vic2NyaWJlci5lcnJvcihEeW5hbWljTG9hZGluZ1RpbWVvdXRFcnJvcigpKTtcbiAgICAgIH0sIDYwMDApO1xuXG4gICAgICBsb2FkZXIuc3JjID0gdXJsO1xuXG4gICAgICBmdW5jdGlvbiBjbGVhbigpOiB2b2lkIHtcbiAgICAgICAgbG9hZGVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobG9hZGVyKTtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsb2FkZXIpO1xuICAgICAgdGhpcy5fanNvbnBJY29uTG9hZCRcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgZmlsdGVyKGkgPT4gaS5uYW1lID09PSBpY29uLm5hbWUgJiYgaS50aGVtZSA9PT0gaWNvbi50aGVtZSksXG4gICAgICAgICAgICAgIHRha2UoMSlcbiAgICAgICAgICApXG4gICAgICAgICAgLnN1YnNjcmliZShpID0+IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXIubmV4dChpKTtcbiAgICAgICAgICAgIGNsZWFuKCk7XG4gICAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGEgbmV3IGBTVkdFbGVtZW50YCBmb3IgYSBnaXZlbiBgSWNvbkRlZmluaXRpb25gLCBvciBtYWtlIGEgY29weSBmcm9tIGNhY2hlLlxuICAgKiBAcGFyYW0gaWNvblxuICAgKiBAcGFyYW0gdHdvVG9uZUNvbG9yXG4gICAqL1xuICBwcm90ZWN0ZWQgX2xvYWRTVkdGcm9tQ2FjaGVPckNyZWF0ZU5ldyhcbiAgICBpY29uOiBJY29uRGVmaW5pdGlvbixcbiAgICB0d29Ub25lQ29sb3I/OiBzdHJpbmdcbiAgKTogU1ZHRWxlbWVudCB7XG4gICAgbGV0IHN2ZzogU1ZHRWxlbWVudDtcblxuICAgIGNvbnN0IHByaSA9IHR3b1RvbmVDb2xvciB8fCB0aGlzLl90d29Ub25lQ29sb3JQYWxldHRlLnByaW1hcnlDb2xvcjtcbiAgICBjb25zdCBzZWMgPVxuICAgICAgZ2V0U2Vjb25kYXJ5Q29sb3IocHJpKSB8fCB0aGlzLl90d29Ub25lQ29sb3JQYWxldHRlLnNlY29uZGFyeUNvbG9yO1xuICAgIGNvbnN0IGtleSA9XG4gICAgICBpY29uLnRoZW1lID09PSAndHdvdG9uZSdcbiAgICAgICAgPyB3aXRoU3VmZml4QW5kQ29sb3IoaWNvbi5uYW1lLCBpY29uLnRoZW1lLCBwcmksIHNlYylcbiAgICAgICAgOiBpY29uLnRoZW1lID09PSB1bmRlZmluZWRcbiAgICAgICAgPyBpY29uLm5hbWVcbiAgICAgICAgOiB3aXRoU3VmZml4KGljb24ubmFtZSwgaWNvbi50aGVtZSk7XG5cbiAgICAvLyBUcnkgdG8gbWFrZSBhIGNvcHkgZnJvbSBjYWNoZS5cbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLl9zdmdSZW5kZXJlZERlZmluaXRpb25zLmdldChrZXkpO1xuXG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgc3ZnID0gY2FjaGVkLmljb247XG4gICAgfSBlbHNlIHtcbiAgICAgIHN2ZyA9IHRoaXMuX3NldFNWR0F0dHJpYnV0ZShcbiAgICAgICAgdGhpcy5fY29sb3JpemVTVkdJY29uKFxuICAgICAgICAgIC8vIEljb25zIHByb3ZpZGVkIGJ5IGFudCBkZXNpZ24gc2hvdWxkIGJlIHJlZmluZWQgdG8gcmVtb3ZlIHByZXNldCBjb2xvcnMuXG4gICAgICAgICAgdGhpcy5fY3JlYXRlU1ZHRWxlbWVudEZyb21TdHJpbmcoXG4gICAgICAgICAgICBoYXNOYW1lc3BhY2UoaWNvbi5uYW1lKSA/IGljb24uaWNvbiA6IHJlcGxhY2VGaWxsQ29sb3IoaWNvbi5pY29uKVxuICAgICAgICAgICksXG4gICAgICAgICAgaWNvbi50aGVtZSA9PT0gJ3R3b3RvbmUnLFxuICAgICAgICAgIHByaSxcbiAgICAgICAgICBzZWNcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIC8vIENhY2hlIGl0LlxuICAgICAgdGhpcy5fc3ZnUmVuZGVyZWREZWZpbml0aW9ucy5zZXQoa2V5LCB7XG4gICAgICAgIC4uLmljb24sXG4gICAgICAgIGljb246IHN2Z1xuICAgICAgfSBhcyBDYWNoZWRJY29uRGVmaW5pdGlvbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsb25lU1ZHKHN2Zyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgX2NyZWF0ZVNWR0VsZW1lbnRGcm9tU3RyaW5nKHN0cjogc3RyaW5nKTogU1ZHRWxlbWVudCB7XG4gICAgY29uc3QgZGl2ID0gdGhpcy5fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2LmlubmVySFRNTCA9IHN0cjtcbiAgICBjb25zdCBzdmc6IFNWR0VsZW1lbnQgPSBkaXYucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgaWYgKCFzdmcpIHtcbiAgICAgIHRocm93IFNWR1RhZ05vdEZvdW5kRXJyb3I7XG4gICAgfVxuICAgIHJldHVybiBzdmc7XG4gIH1cblxuICBwcm90ZWN0ZWQgX3NldFNWR0F0dHJpYnV0ZShzdmc6IFNWR0VsZW1lbnQpOiBTVkdFbGVtZW50IHtcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnLCAnd2lkdGgnLCAnMWVtJyk7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2ZywgJ2hlaWdodCcsICcxZW0nKTtcbiAgICByZXR1cm4gc3ZnO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9jb2xvcml6ZVNWR0ljb24oXG4gICAgc3ZnOiBTVkdFbGVtZW50LFxuICAgIHR3b3RvbmU6IGJvb2xlYW4sXG4gICAgcHJpOiBzdHJpbmcsXG4gICAgc2VjOiBzdHJpbmdcbiAgKTogU1ZHRWxlbWVudCB7XG4gICAgaWYgKHR3b3RvbmUpIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gc3ZnLmNoaWxkTm9kZXM7XG4gICAgICBjb25zdCBsZW5ndGggPSBjaGlsZHJlbi5sZW5ndGg7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkOiBIVE1MRWxlbWVudCA9IGNoaWxkcmVuW2ldIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBpZiAoY2hpbGQuZ2V0QXR0cmlidXRlKCdmaWxsJykgPT09ICdzZWNvbmRhcnlDb2xvcicpIHtcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUoY2hpbGQsICdmaWxsJywgc2VjKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUoY2hpbGQsICdmaWxsJywgcHJpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnLCAnZmlsbCcsICdjdXJyZW50Q29sb3InKTtcbiAgICByZXR1cm4gc3ZnO1xuICB9XG59XG4iXX0=